---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: werfbundles.werf.io
spec:
  group: werf.io
  names:
    kind: WerfBundle
    listKind: WerfBundleList
    plural: werfbundles
    shortNames:
    - wb
    - wbs
    singular: werfbundle
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.lastAppliedTag
      name: LastAppliedTag
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: WerfBundle is the Schema for the werfbundles API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: "WerfBundleSpec defines the desired state of WerfBundle.\nExample:\n\n\tapiVersion:
              werf.io/v1alpha1\n\tkind: WerfBundle\n\tmetadata:\n\t  name: my-app\n\t
              \ namespace: default\n\tspec:\n\t  registry:\n\t    url: ghcr.io/org/bundle\n\t
              \   secretRef:\n\t      name: registry-creds\n\t    pollInterval: 15m\n\t
              \ converge:\n\t    serviceAccountName: werf-converge"
            properties:
              converge:
                description: Converge contains configuration for deploying the bundle
                  with werf converge.
                properties:
                  serviceAccountName:
                    description: |-
                      ServiceAccountName is the name of the ServiceAccount to use for running werf converge Jobs.
                      This ServiceAccount must exist in the bundle's namespace with permissions to create/update resources.
                    minLength: 1
                    type: string
                required:
                - serviceAccountName
                type: object
              registry:
                description: Registry contains configuration for accessing the OCI
                  registry where the bundle is stored.
                properties:
                  pollInterval:
                    default: 15m
                    description: |-
                      PollInterval is the interval at which to poll the registry for new tags (e.g., 15m, 1h).
                      Currently not enforced; reconciliation happens on all events plus periodic resync.
                      Proper interval enforcement will be added in a future release.
                    pattern: ^([0-9]+(ns|us|Âµs|ms|s|m|h))+$
                    type: string
                  secretRef:
                    description: SecretRef is an optional reference to a Secret containing
                      registry credentials.
                    properties:
                      name:
                        default: ""
                        description: |-
                          Name of the referent.
                          This field is effectively required, but due to backwards compatibility is
                          allowed to be empty. Instances of this type with an empty value here are
                          almost certainly wrong.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                        type: string
                    type: object
                    x-kubernetes-map-type: atomic
                  url:
                    description: URL is the OCI registry URL (e.g., ghcr.io/org/bundle).
                    minLength: 1
                    type: string
                required:
                - url
                type: object
            required:
            - converge
            - registry
            type: object
          status:
            description: WerfBundleStatus defines the observed state of WerfBundle.
            properties:
              lastAppliedTag:
                description: LastAppliedTag is the last successfully deployed tag.
                type: string
              lastErrorMessage:
                description: LastErrorMessage is the last error encountered, or empty
                  string if no error.
                type: string
              lastSyncTime:
                description: LastSyncTime is the timestamp of the last successful
                  sync (nil if not yet synced).
                format: date-time
                type: string
              phase:
                description: Phase is the current phase of the bundle (Syncing, Synced,
                  Failed).
                enum:
                - Syncing
                - Synced
                - Failed
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
